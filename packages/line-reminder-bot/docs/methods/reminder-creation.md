# リマインダー作成ロジック

## 概要

LINEユーザーがメッセージを送信すると、自動的に5つの異なるタイミング（5分後、1日後、3日後、7日後、30日後）でリマインダーを作成します。同じメッセージから作成されたリマインダーは`groupId`で紐付けられ、後で一括削除できるようになっています。

## エントリーポイント

- **トリガー**: LINE Messaging APIからのWebhook（テキストメッセージイベント）
- **判定条件**: テキストメッセージイベントを検出した場合、`createReminderFromLine()` を呼び出す

## データフロー

1. LINEからメッセージを受信
2. Webhookリクエストを検証し、イベントを抽出
3. ユーザー認証を実行
4. `createReminderFromLine()` を呼び出し、リマインダーを作成
5. D1データベースにリマインダーを保存（5件）
6. 登録完了メッセージをLINEに返信

## 注意点

### 1. タイムゾーン

日時表示は`Asia/Tokyo`タイムゾーンで表示されます。

### 2. groupIdの重要性

- 同じメッセージから作成された5つのリマインダーは同じ`groupId`を持つ
- これにより削除時に一括削除が可能
- 各リマインダーは個別に通知される（グループではない）

### 3. executionTimeの精度

- ミリ秒単位のUnixタイムスタンプで保存
- Cron実行が5分ごとなので、最大5分の遅延が発生する可能性

### 4. トランザクション

- 5つのINSERTは個別に実行される（トランザクションなし）
- 途中で失敗した場合、一部のリマインダーのみ作成される可能性がある
- エラーはキャッチされ、500エラーが返される

### 5. メッセージの長さ制限

- 現在、メッセージ長の制限チェックは実装されていない
- D1のTEXT型の上限に依存
- 必要に応じてバリデーションを追加すべき
